import requests
import pandas as pd

def fetch_weather_data(coordinates, api_key):
    """
    Fetch weather data for a list of coordinates.
    coordinates: list of [city, lat, lon]
    api_key: OpenWeather API key
    Returns a pandas DataFrame
    """
    data = []
    for city, lat, lon in coordinates:
        response = requests.get(
            f"https://api.openweathermap.org/data/2.5/forecast?lat={lat}&lon={lon}&units=metric&appid={api_key}"
        )
        weather_json = response.json()

        for entry in weather_json["list"]:
            data.append({
                "city": city,
                "date_time": entry["dt_txt"],
                "temp": entry["main"]["temp"],
                "temp_min": entry["main"]["temp_min"],
                "temp_max": entry["main"]["temp_max"],
                "feels_like": entry["main"]["feels_like"],
                "weather_type": entry["weather"][0]["description"],
                "humidity": entry["main"]["humidity"]
            })

    weather_df = pd.DataFrame(data)
    weather_df['date_time'] = pd.to_datetime(weather_df['date_time'])
    return weather_df
